"""
방문할 수 있는 정점이 여러개인 경우 "번호가 작은 것 먼저" 방문
"""
import sys
from collections import defaultdict, deque
input = sys.stdin.readline
N, M, V = list(map(int, input().split()))

graph = defaultdict(list)
for _ in range(M):
    v1, v2 = map(int, input().split())
    graph[v1].append(v2)
    graph[v2].append(v1)

def BFS(point):
    queue = deque()
    queue.append(point)
    visit = [point]
    while queue:
        point
        = queue.popleft()
        next_lists = sorted(graph[point])
        for next_point in next_lists:
            if next_point in visit:continue
            queue.append(next_point)
            visit.append(next_point)
    return visit


def DFS(point, visit):
    if len(visit) == N:
        return visit
    next_lists = sorted(graph[point])#번호가 낮은 것 우선
    for next_point in next_lists:
        if next_point in visit:continue
        temp_visit = visit.copy()
        temp_visit.append(next_point)
        a = DFS(next_point, temp_visit)
        if a:
            return a
        
    
print(DFS(V, [V]))
print(BFS(V))

